(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var o=e.g.document;if(!t&&o&&(o.currentScript&&(t=o.currentScript.src),!t)){var n=o.getElementsByTagName("script");n.length&&(t=n[n.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})();const t="a5aa0925f392e3e2b5f8946d4f7fcd8c";function o(e,t){e.lat=parseFloat(t.parentNode.dataset.lat),e.lon=parseFloat(t.parentNode.dataset.lon)}function n(e){if("string"==typeof e)return e.split(" ").map((e=>e.substring(0,1).toUpperCase()+e.substring(1,e.length))).join(" ")}function a(e,t){if("number"!=typeof e)return;const o=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],n=new Date(e);if("day"===t)return o[n.getDay()];const a=n.getDate(),r=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][n.getMonth()],c=n.getFullYear();return`${o[n.getDay()]}, ${a} ${r} ${c}`}const r=document.querySelector(".currentWeather__title"),c=document.querySelector(".currentWeather__temp"),i=document.querySelector(".currentWeather__icon i"),s=document.querySelector(".currentWeather__desc"),l=document.querySelector(".currentWeather__day"),u=document.querySelector(".currentWeather__maxTemp"),d=document.querySelector(".currentWeather__minTemp"),m=document.querySelector(".currentWeather__humidity"),h=document.querySelector(".currentWeather__more a"),f=document.querySelector("p.outscreen");function p(){b(document.querySelector(".currentWeather")),b(document.querySelector(".nextDaysWeather"))}function g(e,t,o){const n=e.querySelector(".nextDaysWeather__icon i");return e.querySelector(".nextDaysWeather__day").textContent=a(1e3*t.daily[o].dt,"day"),S(t.daily[o].weather[0].icon,n),e.querySelector(".nextDaysWeather__maxTemp").textContent=`${Math.round(t.daily[o].temp.max)}°`,e.querySelector(".nextDaysWeather__minTemp").textContent=`${Math.round(t.daily[o].temp.min)}°`,e}function y(e){e.classList.add("active"),e.matches(".btn-geolocation")||e.parentNode.classList.add("active"),e.matches(".btn-geolocation")&&document.querySelector(".fa-location-crosshairs").classList.toggle("active")}function _(e){document.querySelector(".currentWeather__title").textContent=`Error: ${e}`}function b(e){e.classList.toggle("fade-out"),e.classList.toggle("fade-in")}function S(e,t){const o=e.substr(0,2),n=e.substr(2,e.length);switch(t.removeAttribute("class"),o){case"01":"d"===n?t.classList.add("icon","fa-solid","fa-sun"):t.classList.add("icon","fa-solid","fa-moon");break;case"02":"d"===n?t.classList.add("icon","fa-solid","fa-cloud-sun"):t.classList.add("icon","fa-solid","fa-cloud-moon");break;case"03":case"04":t.classList.add("icon","fa-solid","fa-cloud");break;case"09":t.classList.add("icon","fa-solid","fa-cloud-showers-heavy");break;case"10":"d"===n?t.classList.add("icon","fa-solid","fa-cloud-sun-rain"):t.classList.add("icon","fa-solid","fa-cloud-moon-rain");break;case"11":t.classList.add("icon","fa-solid","fa-cloud-bolt");break;case"13":t.classList.add("icon","fa-solid","fa-snowflake");break;case"50":t.classList.add("icon","fa-solid","fa-smog");break;default:t.classList.add("icon","fa-solid","fa-circle-question")}return t}e.p,e.p,e.p,e.p,e.p,e.p,e.p,e.p;const q=document.querySelector(".nextDaysWeather__list"),v=document.querySelector(".historial__list"),L=document.querySelector(".search__form"),$=document.querySelector(".template-historial").content,x=document.querySelector(".template-nextDays").content,w=document.createDocumentFragment();let C={id:null,lat:null,lon:null,name:null,unit:"metric"},W={lat:null,lon:null},M=[];function D(){if(!navigator.geolocation)return F();navigator.geolocation.getCurrentPosition(k,F)}function k(e){C.lat=parseFloat(e.coords.latitude.toFixed(4)),C.lon=parseFloat(e.coords.longitude.toFixed(4)),W.lat=parseFloat(e.coords.latitude.toFixed(4)),W.lon=parseFloat(e.coords.longitude.toFixed(4)),y(document.querySelector(".btn-geolocation *")),E(C,"coords")}function F(e){_(e?`${e.message}`:"Geolocation not supported")}async function E(e,o){const y=await async function(e,o){const{lat:n,lon:a,name:r,unit:c}=e,i=`https://api.openweathermap.org/data/2.5/weather?${"coords"===o?`lat=${n}&lon=${a}`:`q=${r}`}&units=${c?`${c}`:"metric"}&appid=${t}&lang=es`;try{const e=await fetch(i);return await e.json()}catch(e){console.error(e)}}(e,o);if(200===y.cod){e.lat=y.coord.lat,e.lon=y.coord.lon,e.id=y.id,e.name=`${y.name}, ${y.sys.country}`,localStorage.getItem("historial")&&(M=JSON.parse(localStorage.getItem("historial"))),T(),function(e,t){e.lat!==t.lat||e.lon!==t.lon?(document.querySelector(".btn-geolocation").classList.remove("active"),document.querySelector(".btn-geolocation *").classList.remove("active")):(document.querySelector(".btn-geolocation").classList.add("active"),document.querySelector(".btn-geolocation *").classList.add("active"))}(W,e);const _=await async function(e){const{lat:o,lon:n,unit:a}=e,r=`https://api.openweathermap.org/data/2.5/onecall?lat=${o}&lon=${n}&exclude=minutely,hourly,alerts&units=${a}&appid=${t}`;try{const e=await fetch(r);return await e.json()}catch(e){console.error(e)}}(e);if("q"===o&&function(e){M=M.filter((t=>e.lat!==t.lat&&e.lon!==t.lon)),M.unshift(e),M=M.splice(0,10),T()}(e),_)return function(e,t){p(),function(e,t){let o="metric"===t.unit?"Celsius":"Fahrenheit";r.textContent=t.name,c.textContent=`${Math.round(e.current.temp)}°`,S(e.current.weather[0].icon,i),i.alt=e.current.weather[0].description,s.textContent=n(e.current.weather[0].description),l.textContent=`${a(1e3*e.daily[0].dt,"fullDate")}`,u.textContent=`Max ${Math.round(e.daily[0].temp.max)}°`,d.textContent=`Min ${Math.round(e.daily[0].temp.min)}°`,m.textContent=`Humedad: ${Math.round(e.current.humidity)}%`,h.href=`https://openweathermap.org/city/${t.id}`,h.rel="noopener noreferrer",h.target="_blank",h.textContent="Ver más...",f.textContent=`El clima para ${a(1e3*e.daily[0].dt,"fullDate")} es de ${Math.round(e.current.temp)} ° ${o} en la ciudad de ${t.name}`}(e,t),q.innerHTML="";for(let t=1;t<4;t++){const o=document.importNode(x,!0);g(o,e,t),w.appendChild(o)}q.appendChild(w),p()}(_,e)}else _(n(y.message)),setTimeout((()=>{D()}),2e3)}function T(){localStorage.setItem("historial",JSON.stringify(M)),0!==M.length?(v.innerHTML="",M.forEach((e=>{const t=document.importNode($,!0);var o,n;n=e,(o=t).querySelector(".historial__item").dataset.lat=n.lat,o.querySelector(".historial__item").dataset.lon=n.lon,o.querySelector(".historial__name").textContent=n.name,o.querySelector(".historial__btn").dataset.lat=n.lat,o.querySelector(".historial__btn").dataset.lon=n.lon,w.append(t)})),v.appendChild(w)):v.innerHTML="\n        <p>No has realizado búsquedas</p>\n        "}async function N(e){e.preventDefault();const t=document.querySelector(".search__input"),o=function(e){if("string"==typeof e)return e.trim().replace(/ {2,} /g," ")}(t.value);if(!o.length)return t.value="",t.focus(),alert("Debes ingresar una ciudad.");C.name=o,E(C,"q"),t.value="",t.blur()}"serviceWorker"in navigator&&window.addEventListener("load",(()=>{navigator.serviceWorker.register("/service-worker.js").then((e=>{console.log("SW registered: ",e)})).catch((e=>{console.log("SW registration failed: ",e)}))})),document.addEventListener("DOMContentLoaded",(()=>{document.addEventListener("click",(e=>{!function(e){(e.target.matches(".btn-geolocation")||e.target.matches(".btn-geolocation *"))&&(D(),y(e.target)),(e.target.matches(".btn-unit")||e.target.matches(".btn-unit *"))&&(C.unit="metric"===C.unit?"imperial":"metric",E(C,"coords"),document.querySelector(".celsius").classList.toggle("none"),document.querySelector(".fahrenheit").classList.toggle("none")),e.target.matches(".historial__name")&&(o(C,e.target),E(C,"coords")),(e.target.matches(".historial__btn")||e.target.matches(".historial__btn *"))&&(o(C,e.target),function(e){M=M.filter((t=>e.lat!==t.lat&&e.lon!==t.lon)),T()}(C))}(e)})),L.addEventListener("submit",N),D()})),document.addEventListener("keyup",(e=>{if(e.target.matches(".search__input")){const t=function(e){if(/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŽ∂ð ,.'-]+$/u.exec(e)&&""!==e.trim())return e}(e.target.value);!function(e,t){const o=document.querySelector(`#${e.name}`);if(!document.body.contains(o)){const t=document.createElement("span"),o=document.querySelector(".search__form");t.id=e.name,t.textContent="Ingresa un nombre válido. Por ejemplo, Madrid o Madrid, ES",t.classList.add("search-error","none"),o.insertAdjacentElement("afterend",t)}!function(e){const t=document.querySelector(".btn-search");void 0===e?(t.disabled=!0,document.querySelector(".search-error").classList.add("is-active")):(document.querySelector(".search-error").classList.remove("is-active"),t.disabled=!1)}(t)}(e.target,t)}}))})();